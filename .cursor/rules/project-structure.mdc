---
alwaysApply: true
---
### 项目结构与约定

- Monorepo 约定：
  - `apps/web`：Next.js 前端（TypeScript，App Router，Tailwind + shadcn/ui）。
  - `apps/server`：NestJS 后端（REST + WebSocket，Prisma，BullMQ）。
  - `packages/shared`：前后端共享类型与工具。
  - `infra/observability`：Prometheus、VictoriaMetrics、Loki、Grafana、（可选）cAdvisor 的配置与编排。
  - `docs`：项目文档与设计说明。

- 运行与网络：
  - 默认 Agentless：通过系统 `ssh/scp/rsync` 执行远程操作，启用 StrictHostKeyChecking。
  - 控制平面仅暴露 443，直连各 VPS 的 22 端口。

- 观测与保留：
  - 指标：Prometheus 抓取 Node Exporter → remote_write 到 VictoriaMetrics，保留 7 天。
  - 日志：Promtail → Loki，保留 7 天。
  - 可选：cAdvisor 提供容器级指标（默认关闭，按需一键启用）。

- 容器管理：
  - 发现：`docker ps -a` + `docker inspect`；识别 Compose 标签。
  - 更新：Compose 优先（pull → up -d --no-deps）；CLI 容器支持“备份并回滚”。
  - 定时：默认每日执行“更新检查”。

- 不包含：
  - 审计/审批/RBAC/SSO/工单；私有镜像仓库鉴权（后续可选）。

若目录尚未创建，请按照上述结构落盘，以便导航与开发协同。

更多背景与完整架构说明参见项目文档：[docs/PROJECT_SPEC.md](mdc:docs/PROJECT_SPEC.md)

